{
  "feature": "전화번호 중복 체크 - 프론트엔드",
  "description": "SMS 발송 API의 409 응답을 처리하여 중복 전화번호 에러 표시",
  "approach": "백엔드 통합 방식 - 별도 API 호출 없이 SMS 발송 응답에서 처리",

  "current_state": {
    "file": "src/hooks/useSmsAuth.ts",
    "issue": "별도 checkPhoneDuplicate API 호출 중 (불필요한 네트워크 요청)",
    "to_remove": [
      "checkPhoneDuplicate import",
      "checkPhoneDuplicate 호출 로직"
    ]
  },

  "implementation": {
    "file": "src/hooks/useSmsAuth.ts",
    "changes": [
      {
        "action": "remove_import",
        "before": "import { getApiConfig, checkPhoneDuplicate } from '../services/auth';",
        "after": "import { getApiConfig } from '../services/auth';"
      },
      {
        "action": "remove_duplicate_check",
        "location": "sendSms 함수 내부",
        "remove_lines": [
          "// 1. 전화번호 중복 체크 (SMS 발송 전)",
          "const duplicateResult = await checkPhoneDuplicate(plainPhone);",
          "if (duplicateResult.isDuplicate) {",
          "    setError(duplicateResult.message || '이미 가입된 전화번호입니다.');",
          "    setIsLoading(false);",
          "    return;",
          "}"
        ]
      },
      {
        "action": "add_409_handling",
        "location": "sendSms 함수의 response.ok 체크 부분",
        "before": {
          "code": [
            "if (response.status === 429) {",
            "    setError('요청이 너무 많습니다. 잠시 후 다시 시도해주세요.');",
            "} else if (response.status === 400) {",
            "    setError(errorData.message || '입력값 오류입니다.');",
            "} else {",
            "    setError('서버 오류입니다. 인증번호 전송에 실패했습니다.');",
            "}"
          ]
        },
        "after": {
          "code": [
            "if (response.status === 409) {",
            "    setError(errorData.message || '이미 가입된 전화번호입니다.');",
            "} else if (response.status === 429) {",
            "    setError('요청이 너무 많습니다. 잠시 후 다시 시도해주세요.');",
            "} else if (response.status === 400) {",
            "    setError(errorData.message || '입력값 오류입니다.');",
            "} else {",
            "    setError('서버 오류입니다. 인증번호 전송에 실패했습니다.');",
            "}"
          ]
        }
      }
    ],
    "cleanup": {
      "file": "src/services/auth.js",
      "action": "checkPhoneDuplicate 함수 삭제 (선택사항, 미사용 코드 정리)"
    }
  },

  "final_code_structure": {
    "sendSms_function": [
      "const sendSms = async (): Promise<string | undefined> => {",
      "    const plainPhone = phone.replace(/-/g, '');",
      "    const phoneRegex = /^01([0|1|6|7|8|9])([0-9]{3,4})([0-9]{4})$/;",
      "",
      "    if (!phoneRegex.test(plainPhone)) {",
      "        setError('올바른 전화번호를 입력해주세요 (010-XXXX-XXXX).');",
      "        return;",
      "    }",
      "",
      "    setIsLoading(true);",
      "    setError(null);",
      "",
      "    try {",
      "        const { API_BASE_URL, headers } = getApiConfig();",
      "",
      "        const response = await fetch(`${API_BASE_URL}/api/auth/sms/send`, {",
      "            method: 'POST',",
      "            headers,",
      "            body: JSON.stringify({ phone: plainPhone }),",
      "        });",
      "",
      "        if (!response.ok) {",
      "            const errorData = await response.json().catch(() => ({}));",
      "",
      "            if (response.status === 409) {",
      "                setError(errorData.message || '이미 가입된 전화번호입니다.');",
      "            } else if (response.status === 429) {",
      "                setError('요청이 너무 많습니다. 잠시 후 다시 시도해주세요.');",
      "            } else if (response.status === 400) {",
      "                setError(errorData.message || '입력값 오류입니다.');",
      "            } else {",
      "                setError('서버 오류입니다. 인증번호 전송에 실패했습니다.');",
      "            }",
      "            return;",
      "        }",
      "",
      "        // ... 성공 로직",
      "    } catch (err) {",
      "        setError('네트워크 오류입니다. 연결 상태를 확인해주세요.');",
      "    } finally {",
      "        setIsLoading(false);",
      "    }",
      "};"
    ]
  },

  "ui_behavior": {
    "duplicate_phone": {
      "trigger": "SMS 발송 API가 409 반환",
      "display": "입력 필드 하단에 에러 메시지",
      "message": "이미 가입된 전화번호입니다.",
      "style": {
        "color": "#F76241",
        "fontSize": "14px"
      }
    }
  },

  "testing": [
    {
      "case": "신규 전화번호",
      "expected": "SMS 정상 발송, 인증코드 입력 페이지로 이동"
    },
    {
      "case": "중복 전화번호",
      "backend_response": "409 Conflict",
      "expected": "에러 메시지 표시, 페이지 유지"
    }
  ]
}
